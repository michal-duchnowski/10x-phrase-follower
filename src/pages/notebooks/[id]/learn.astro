---
import AppLayout from "../../../layouts/AppLayout.astro";
import AuthGuard from "../../../components/AuthGuard";
import LearnView from "../../../components/LearnView";

const { id } = Astro.params;
const difficulty = Astro.url.searchParams.get("difficulty");
const phraseIdsParam = Astro.url.searchParams.get("phrase_ids");
const phraseIds = phraseIdsParam ? phraseIdsParam.split(",") : undefined;

if (!id) {
  return Astro.redirect("/notebooks");
}

// Validate notebook ID format (UUID or virtual notebook ID)
const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;
const virtualNotebookRegex = /^difficulty-(easy|medium|hard)$/;
if (!uuidRegex.test(id) && !virtualNotebookRegex.test(id)) {
  return Astro.redirect("/notebooks");
}
---

<AppLayout title="Learn mode - Phrase Follower" currentPath={`/notebooks/${id}/learn`} fullWidth={true}>
  <AuthGuard client:load>
    <LearnView notebookId={id} difficultyFilter={difficulty || undefined} phraseIds={phraseIds} client:load />
  </AuthGuard>
</AppLayout>
